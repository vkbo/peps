
<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PEP 3145 – Asynchronous I/O For subprocess.Popen | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png"/>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/mq.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <meta name="description" content="Python Enhancement Proposals (PEPs)"/>
</head>
<body>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 3145 – Asynchronous I/O For subprocess.Popen</li>
            </ul>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 3145 – Asynchronous I/O For subprocess.Popen</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd">3145</dd>
<dt class="field-even">Title</dt>
<dd class="field-even">Asynchronous I/O For subprocess.Popen</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd">(James) Eric Pruitt, Charles R. McCreary, Josiah Carlson</dd>
<dt class="field-even">Status</dt>
<dd class="field-even">Withdrawn</dd>
<dt class="field-odd">Type</dt>
<dd class="field-odd">Standards Track</dd>
<dt class="field-even">Created</dt>
<dd class="field-even">04-Aug-2009</dd>
<dt class="field-odd">Python-Version</dt>
<dd class="field-odd">3.2</dd>
<dt class="field-even">Post-History</dt>
<dd class="field-even"><p></p></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<h2>Contents</h2>
<ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#pep-deferral">PEP Deferral</a></li>
<li><a class="reference internal" href="#pep-withdrawal">PEP Withdrawal</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract">Abstract</a></h2>
<p>In its present form, the <code class="docutils literal notranslate"><span class="pre">subprocess.Popen</span></code> implementation is prone to
dead-locking and blocking of the parent Python script while waiting on data
from the child process. This PEP proposes to make
<code class="docutils literal notranslate"><span class="pre">subprocess.Popen</span></code> more asynchronous to help alleviate these
problems.</p>
</section>
<section id="pep-deferral">
<h2><a class="toc-backref" href="#pep-deferral">PEP Deferral</a></h2>
<p>Further exploration of the concepts covered in this PEP has been deferred
at least until after <a class="reference external" href="../pep-3156">PEP 3156</a> has been resolved.</p>
</section>
<section id="pep-withdrawal">
<h2><a class="toc-backref" href="#pep-withdrawal">PEP Withdrawal</a></h2>
<p>This can be dealt with in the bug tracker.  A specific proposal is
attached to <a class="footnote-reference brackets" href="#id23" id="id1">11</a>.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation">Motivation</a></h2>
<p>A search for “python asynchronous subprocess” will turn up numerous
accounts of people wanting to execute a child process and communicate with
it from time to time reading only the data that is available instead of
blocking to wait for the program to produce data <a class="footnote-reference brackets" href="#id13" id="id2">1</a> <a class="footnote-reference brackets" href="#id14" id="id3">2</a> <a class="footnote-reference brackets" href="#id15" id="id4">3</a>.  The current
behavior of the <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> module is that when a user sends or receives
data via the stdin, stderr and stdout file objects, dead locks are common
and documented <a class="footnote-reference brackets" href="#id16" id="id5">4</a> <a class="footnote-reference brackets" href="#id17" id="id6">5</a>.  While communicate can be used to alleviate some of
the buffering issues, it will still cause the parent process to block while
attempting to read data when none is available to be read from the child
process.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale">Rationale</a></h2>
<p>There is a documented need for asynchronous, non-blocking functionality in
<code class="docutils literal notranslate"><span class="pre">subprocess.Popen</span></code> <a class="footnote-reference brackets" href="#id18" id="id7">6</a> <a class="footnote-reference brackets" href="#id19" id="id8">7</a> <a class="footnote-reference brackets" href="#id14" id="id9">2</a> <a class="footnote-reference brackets" href="#id15" id="id10">3</a>.  Inclusion of the code would improve the
utility of the Python standard library that can be used on Unix based and
Windows builds of Python.  Practically every I/O object in Python has a
file-like wrapper of some sort.  Sockets already act as such and for
strings there is <code class="docutils literal notranslate"><span class="pre">StringIO</span></code>.  Popen can be made to act like a file by simply
using the methods attached to the <code class="docutils literal notranslate"><span class="pre">subprocess.Popen.stderr</span></code>, stdout and
stdin file-like objects.  But when using the read and write methods of
those options, you do not have the benefit of asynchronous I/O.  In the
proposed solution the wrapper wraps the asynchronous methods to mimic a
file object.</p>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation">Reference Implementation</a></h2>
<p>I have been maintaining a Google Code repository that contains all of my
changes including tests and documentation <a class="footnote-reference brackets" href="#id21" id="id11">9</a> as well as blog detailing
the problems I have come across in the development process <a class="footnote-reference brackets" href="#id22" id="id12">10</a>.</p>
<p>I have been working on implementing non-blocking asynchronous I/O in the
<code class="docutils literal notranslate"><span class="pre">subprocess</span></code> module as well as a wrapper class for <code class="docutils literal notranslate"><span class="pre">subprocess.Popen</span></code>
that makes it so that an executed process can take the place of a file by
duplicating all of the methods and attributes that file objects have.</p>
<p>There are two base functions that have been added to the <code class="docutils literal notranslate"><span class="pre">subprocess.Popen</span></code>
class: <code class="docutils literal notranslate"><span class="pre">Popen.send</span></code> and <code class="docutils literal notranslate"><span class="pre">Popen._recv</span></code>, each with two separate implementations,
one for Windows and one for Unix-based systems.  The Windows
implementation uses ctypes to access the functions needed to control pipes
in the kernel 32 DLL in an asynchronous manner.  On Unix based systems,
the Python interface for file control serves the same purpose.  The
different implementations of <code class="docutils literal notranslate"><span class="pre">Popen.send</span></code> and <code class="docutils literal notranslate"><span class="pre">Popen._recv</span></code> have identical
arguments to make code that uses these functions work across multiple
platforms.</p>
<p>When calling the <code class="docutils literal notranslate"><span class="pre">Popen._recv</span></code> function, it requires the pipe name be
passed as an argument so there exists the <code class="docutils literal notranslate"><span class="pre">Popen.recv</span></code> function that passes
selects stdout as the pipe for <code class="docutils literal notranslate"><span class="pre">Popen._recv</span></code> by default. <code class="docutils literal notranslate"><span class="pre">Popen.recv_err</span></code>
selects stderr as the pipe by default. <code class="docutils literal notranslate"><span class="pre">Popen.recv</span></code> and <code class="docutils literal notranslate"><span class="pre">Popen.recv_err</span></code>
are much easier to read and understand than <code class="docutils literal notranslate"><span class="pre">Popen._recv('stdout'</span> <span class="pre">...)</span></code> and
<code class="docutils literal notranslate"><span class="pre">Popen._recv('stderr'</span> <span class="pre">...)</span></code> respectively.</p>
<p>Since the <code class="docutils literal notranslate"><span class="pre">Popen._recv</span></code> function does not wait on data to be produced
before returning a value, it may return empty bytes. <code class="docutils literal notranslate"><span class="pre">Popen.asyncread</span></code>
handles this issue by returning all data read over a given time
interval.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ProcessIOWrapper</span></code> class uses the <code class="docutils literal notranslate"><span class="pre">asyncread</span></code> and <code class="docutils literal notranslate"><span class="pre">asyncwrite</span></code> functions to
allow a process to act like a file so that there are no blocking issues
that can arise from using the stdout and stdin file objects produced from
a <code class="docutils literal notranslate"><span class="pre">subprocess.Popen</span></code> call.</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#references">References</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id13"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd>[ python-Feature Requests-1191964 ] asynchronous Subprocess
<a class="reference external" href="https://mail.python.org/pipermail/python-bugs-list/2006-December/">https://mail.python.org/pipermail/python-bugs-list/2006-December/</a>
036524.html</dd>
<dt class="label" id="id14"><span class="brackets">2</span><span class='fn-backref''><em> (<a href='#id3'>1</a>, <a href='#id9'>2</a>) </em></span></dt>
<dd>Daily Life in an Ivory Basement : /feb-07/problems-with-subprocess
<a class="reference external" href="http://ivory.idyll.org/blog/feb-07/problems-with-subprocess">http://ivory.idyll.org/blog/feb-07/problems-with-subprocess</a></dd>
<dt class="label" id="id15"><span class="brackets">3</span><span class='fn-backref''><em> (<a href='#id4'>1</a>, <a href='#id10'>2</a>) </em></span></dt>
<dd>How can I run an external command asynchronously from Python? - Stack
Overflow
<a class="reference external" href="http://stackoverflow.com/questions/636561/how-can-i-run-an-external">http://stackoverflow.com/questions/636561/how-can-i-run-an-external</a>-
command-asynchronously-from-python</dd>
<dt class="label" id="id16"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd>18.1. subprocess - Subprocess management - Python v2.6.2 documentation
<a class="reference external" href="http://docs.python.org/library/subprocess.html#subprocess.Popen.wait">http://docs.python.org/library/subprocess.html#subprocess.Popen.wait</a></dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id6">5</a></span></dt>
<dd>18.1. subprocess - Subprocess management - Python v2.6.2 documentation
<a class="reference external" href="http://docs.python.org/library/subprocess.html#subprocess.Popen.kill">http://docs.python.org/library/subprocess.html#subprocess.Popen.kill</a></dd>
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id7">6</a></span></dt>
<dd>Issue 1191964: asynchronous Subprocess - Python tracker
<a class="reference external" href="http://bugs.python.org/issue1191964">http://bugs.python.org/issue1191964</a></dd>
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id8">7</a></span></dt>
<dd>Module to allow Asynchronous subprocess use on Windows and Posix
platforms - ActiveState Code
<a class="reference external" href="http://code.activestate.com/recipes/440554/">http://code.activestate.com/recipes/440554/</a></dd>
<dt class="label" id="id20"><span class="brackets">8</span></dt>
<dd>subprocess.rst - subprocdev - Project Hosting on Google Code
<a class="reference external" href="http://code.google.com/p/subprocdev/source/browse/doc/subprocess.rst?spec=svn2c925e935cad0166d5da85e37c742d8e7f609de5&amp;r=2c925e935cad0166d5da85e37c742d8e7f609de5#437">http://code.google.com/p/subprocdev/source/browse/doc/subprocess.rst?spec=svn2c925e935cad0166d5da85e37c742d8e7f609de5&amp;r=2c925e935cad0166d5da85e37c742d8e7f609de5#437</a></dd>
<dt class="label" id="id21"><span class="brackets"><a class="fn-backref" href="#id11">9</a></span></dt>
<dd>subprocdev - Project Hosting on Google Code
<a class="reference external" href="http://code.google.com/p/subprocdev">http://code.google.com/p/subprocdev</a></dd>
<dt class="label" id="id22"><span class="brackets"><a class="fn-backref" href="#id12">10</a></span></dt>
<dd>Python Subprocess Dev
<a class="reference external" href="http://subdev.blogspot.com/">http://subdev.blogspot.com/</a></dd>
<dt class="label" id="id23"><span class="brackets"><a class="fn-backref" href="#id1">11</a></span></dt>
<dd><a class="reference external" href="https://bugs.python.org/issue18823">https://bugs.python.org/issue18823</a> – Idle: use pipes instead of
sockets to talk with user subprocess</dd>
</dl>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright">Copyright</a></h2>
<p>This P.E.P. is licensed under the Open Publication License;
<a class="reference external" href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a>.</p>
</section>
</section>
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/master/pep-3145.txt">https://github.com/python/peps/blob/master/pep-3145.txt</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/master/pep-3145.txt">2017-11-11 19:28:55 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#">PEP 3145 – Asynchronous I/O For subprocess.Popen</a><ul>
<li><a class="reference internal" href="#contents">Contents</a></li>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#pep-deferral">PEP Deferral</a></li>
<li><a class="reference internal" href="#pep-withdrawal">PEP Withdrawal</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</li>
</ul>

            <br />
            <strong><a href="https://github.com/python/peps/blob/master/pep-3145.txt">Page Source (GitHub)</a></strong>
        </nav>
    </section>
    <script src="../_static/doctools.js"></script>
</body>
</html>